{"version":3,"file":"2d.js","sources":["../../../../../../../../../../../../../../../node_modules/rrweb/es/rrweb/packages/rrweb/src/record/observers/canvas/2d.js"],"sourcesContent":["import { __values, __spreadArray, __read } from '../../../../ext/tslib/tslib.es6.js';\nimport { CanvasContext } from '../../../types.js';\nimport { patch, isBlocked, hookSetter } from '../../../utils.js';\n\nfunction initCanvas2DMutationObserver(cb, win, blockClass, mirror) {\n    var e_1, _a;\n    var handlers = [];\n    var props2D = Object.getOwnPropertyNames(win.CanvasRenderingContext2D.prototype);\n    var _loop_1 = function (prop) {\n        try {\n            if (typeof win.CanvasRenderingContext2D.prototype[prop] !== 'function') {\n                return \"continue\";\n            }\n            var restoreHandler = patch(win.CanvasRenderingContext2D.prototype, prop, function (original) {\n                return function () {\n                    var _this = this;\n                    var args = [];\n                    for (var _i = 0; _i < arguments.length; _i++) {\n                        args[_i] = arguments[_i];\n                    }\n                    if (!isBlocked(this.canvas, blockClass)) {\n                        setTimeout(function () {\n                            var recordArgs = __spreadArray([], __read(args), false);\n                            if (prop === 'drawImage') {\n                                if (recordArgs[0] &&\n                                    recordArgs[0] instanceof HTMLCanvasElement) {\n                                    var canvas = recordArgs[0];\n                                    var ctx = canvas.getContext('2d');\n                                    var imgd = ctx === null || ctx === void 0 ? void 0 : ctx.getImageData(0, 0, canvas.width, canvas.height);\n                                    var pix = imgd === null || imgd === void 0 ? void 0 : imgd.data;\n                                    recordArgs[0] = JSON.stringify(pix);\n                                }\n                            }\n                            cb(_this.canvas, {\n                                type: CanvasContext['2D'],\n                                property: prop,\n                                args: recordArgs,\n                            });\n                        }, 0);\n                    }\n                    return original.apply(this, args);\n                };\n            });\n            handlers.push(restoreHandler);\n        }\n        catch (_b) {\n            var hookHandler = hookSetter(win.CanvasRenderingContext2D.prototype, prop, {\n                set: function (v) {\n                    cb(this.canvas, {\n                        type: CanvasContext['2D'],\n                        property: prop,\n                        args: [v],\n                        setter: true,\n                    });\n                },\n            });\n            handlers.push(hookHandler);\n        }\n    };\n    try {\n        for (var props2D_1 = __values(props2D), props2D_1_1 = props2D_1.next(); !props2D_1_1.done; props2D_1_1 = props2D_1.next()) {\n            var prop = props2D_1_1.value;\n            _loop_1(prop);\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (props2D_1_1 && !props2D_1_1.done && (_a = props2D_1.return)) _a.call(props2D_1);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n    return function () {\n        handlers.forEach(function (h) { return h(); });\n    };\n}\n\nexport default initCanvas2DMutationObserver;\n"],"names":[],"mappings":"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"}