{"version":3,"file":"virtual-styles.js","sources":["../../../../../../../../../../../../../node_modules/rrweb/es/rrweb/packages/rrweb/src/replay/virtual-styles.js"],"sourcesContent":["import { __spreadArray, __read } from '../../ext/tslib/tslib.es6.js';\n\nvar StyleRuleType;\n(function (StyleRuleType) {\n    StyleRuleType[StyleRuleType[\"Insert\"] = 0] = \"Insert\";\n    StyleRuleType[StyleRuleType[\"Remove\"] = 1] = \"Remove\";\n    StyleRuleType[StyleRuleType[\"Snapshot\"] = 2] = \"Snapshot\";\n    StyleRuleType[StyleRuleType[\"SetProperty\"] = 3] = \"SetProperty\";\n    StyleRuleType[StyleRuleType[\"RemoveProperty\"] = 4] = \"RemoveProperty\";\n})(StyleRuleType || (StyleRuleType = {}));\nfunction getNestedRule(rules, position) {\n    var rule = rules[position[0]];\n    if (position.length === 1) {\n        return rule;\n    }\n    else {\n        return getNestedRule(rule.cssRules[position[1]]\n            .cssRules, position.slice(2));\n    }\n}\nfunction getPositionsAndIndex(nestedIndex) {\n    var positions = __spreadArray([], __read(nestedIndex), false);\n    var index = positions.pop();\n    return { positions: positions, index: index };\n}\nfunction applyVirtualStyleRulesToNode(storedRules, styleNode) {\n    var sheet = styleNode.sheet;\n    if (!sheet) {\n        return;\n    }\n    storedRules.forEach(function (rule) {\n        if (rule.type === StyleRuleType.Insert) {\n            try {\n                if (Array.isArray(rule.index)) {\n                    var _a = getPositionsAndIndex(rule.index), positions = _a.positions, index = _a.index;\n                    var nestedRule = getNestedRule(sheet.cssRules, positions);\n                    nestedRule.insertRule(rule.cssText, index);\n                }\n                else {\n                    sheet.insertRule(rule.cssText, rule.index);\n                }\n            }\n            catch (e) {\n            }\n        }\n        else if (rule.type === StyleRuleType.Remove) {\n            try {\n                if (Array.isArray(rule.index)) {\n                    var _b = getPositionsAndIndex(rule.index), positions = _b.positions, index = _b.index;\n                    var nestedRule = getNestedRule(sheet.cssRules, positions);\n                    nestedRule.deleteRule(index || 0);\n                }\n                else {\n                    sheet.deleteRule(rule.index);\n                }\n            }\n            catch (e) {\n            }\n        }\n        else if (rule.type === StyleRuleType.Snapshot) {\n            restoreSnapshotOfStyleRulesToNode(rule.cssTexts, styleNode);\n        }\n        else if (rule.type === StyleRuleType.SetProperty) {\n            var nativeRule = getNestedRule(sheet.cssRules, rule.index);\n            nativeRule.style.setProperty(rule.property, rule.value, rule.priority);\n        }\n        else if (rule.type === StyleRuleType.RemoveProperty) {\n            var nativeRule = getNestedRule(sheet.cssRules, rule.index);\n            nativeRule.style.removeProperty(rule.property);\n        }\n    });\n}\nfunction restoreSnapshotOfStyleRulesToNode(cssTexts, styleNode) {\n    var _a;\n    try {\n        var existingRules = Array.from(((_a = styleNode.sheet) === null || _a === void 0 ? void 0 : _a.cssRules) || []).map(function (rule) { return rule.cssText; });\n        var existingRulesReversed = Object.entries(existingRules).reverse();\n        var lastMatch_1 = existingRules.length;\n        existingRulesReversed.forEach(function (_a) {\n            var _b;\n            var _c = __read(_a, 2), index = _c[0], rule = _c[1];\n            var indexOf = cssTexts.indexOf(rule);\n            if (indexOf === -1 || indexOf > lastMatch_1) {\n                try {\n                    (_b = styleNode.sheet) === null || _b === void 0 ? void 0 : _b.deleteRule(Number(index));\n                }\n                catch (e) {\n                }\n            }\n            lastMatch_1 = indexOf;\n        });\n        cssTexts.forEach(function (cssText, index) {\n            var _a, _b, _c;\n            try {\n                if (((_b = (_a = styleNode.sheet) === null || _a === void 0 ? void 0 : _a.cssRules[index]) === null || _b === void 0 ? void 0 : _b.cssText) !== cssText) {\n                    (_c = styleNode.sheet) === null || _c === void 0 ? void 0 : _c.insertRule(cssText, index);\n                }\n            }\n            catch (e) {\n            }\n        });\n    }\n    catch (e) {\n    }\n}\nfunction storeCSSRules(parentElement, virtualStyleRulesMap) {\n    var _a;\n    try {\n        var cssTexts = Array.from(((_a = parentElement.sheet) === null || _a === void 0 ? void 0 : _a.cssRules) || []).map(function (rule) { return rule.cssText; });\n        virtualStyleRulesMap.set(parentElement, [\n            {\n                type: StyleRuleType.Snapshot,\n                cssTexts: cssTexts,\n            },\n        ]);\n    }\n    catch (e) {\n    }\n}\n\nexport { StyleRuleType, applyVirtualStyleRulesToNode, getNestedRule, getPositionsAndIndex, storeCSSRules };\n"],"names":[],"mappings":"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"}