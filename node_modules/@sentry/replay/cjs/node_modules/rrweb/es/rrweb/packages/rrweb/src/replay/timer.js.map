{"version":3,"file":"timer.js","sources":["../../../../../../../../../../../../../node_modules/rrweb/es/rrweb/packages/rrweb/src/replay/timer.js"],"sourcesContent":["import { EventType, IncrementalSource } from '../types.js';\n\nvar Timer = (function () {\n    function Timer(actions, speed) {\n        if (actions === void 0) { actions = []; }\n        this.timeOffset = 0;\n        this.raf = null;\n        this.actions = actions;\n        this.speed = speed;\n    }\n    Timer.prototype.addAction = function (action) {\n        var index = this.findActionIndex(action);\n        this.actions.splice(index, 0, action);\n    };\n    Timer.prototype.addActions = function (actions) {\n        this.actions = this.actions.concat(actions);\n    };\n    Timer.prototype.start = function () {\n        this.timeOffset = 0;\n        var lastTimestamp = performance.now();\n        var actions = this.actions;\n        var self = this;\n        function check() {\n            var time = performance.now();\n            self.timeOffset += (time - lastTimestamp) * self.speed;\n            lastTimestamp = time;\n            while (actions.length) {\n                var action = actions[0];\n                if (self.timeOffset >= action.delay) {\n                    actions.shift();\n                    action.doAction();\n                }\n                else {\n                    break;\n                }\n            }\n            if (actions.length > 0 || self.liveMode) {\n                self.raf = requestAnimationFrame(check);\n            }\n        }\n        this.raf = requestAnimationFrame(check);\n    };\n    Timer.prototype.clear = function () {\n        if (this.raf) {\n            cancelAnimationFrame(this.raf);\n            this.raf = null;\n        }\n        this.actions.length = 0;\n    };\n    Timer.prototype.setSpeed = function (speed) {\n        this.speed = speed;\n    };\n    Timer.prototype.toggleLiveMode = function (mode) {\n        this.liveMode = mode;\n    };\n    Timer.prototype.isActive = function () {\n        return this.raf !== null;\n    };\n    Timer.prototype.findActionIndex = function (action) {\n        var start = 0;\n        var end = this.actions.length - 1;\n        while (start <= end) {\n            var mid = Math.floor((start + end) / 2);\n            if (this.actions[mid].delay < action.delay) {\n                start = mid + 1;\n            }\n            else if (this.actions[mid].delay > action.delay) {\n                end = mid - 1;\n            }\n            else {\n                return mid + 1;\n            }\n        }\n        return start;\n    };\n    return Timer;\n}());\nfunction addDelay(event, baselineTime) {\n    if (event.type === EventType.IncrementalSnapshot &&\n        event.data.source === IncrementalSource.MouseMove) {\n        var firstOffset = event.data.positions[0].timeOffset;\n        var firstTimestamp = event.timestamp + firstOffset;\n        event.delay = firstTimestamp - baselineTime;\n        return firstTimestamp - baselineTime;\n    }\n    event.delay = event.timestamp - baselineTime;\n    return event.delay;\n}\n\nexport { Timer, addDelay };\n"],"names":["EventType","IncrementalSource"],"mappings":"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"}