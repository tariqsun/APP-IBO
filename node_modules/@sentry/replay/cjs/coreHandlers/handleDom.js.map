{"version":3,"file":"handleDom.js","sources":["../../../../src/coreHandlers/handleDom.ts"],"sourcesContent":["import { Breadcrumb } from '@sentry/types';\nimport { htmlTreeAsString } from '@sentry/utils';\nimport { record } from 'rrweb';\n\nimport { createBreadcrumb } from '../util/createBreadcrumb';\n\nexport interface DomHandlerData {\n  name: string;\n  event: Node | { target: Node };\n}\n\n/**\n * An event handler to react to DOM events.\n */\nexport function handleDom(handlerData: DomHandlerData): Breadcrumb | null {\n  // Taken from https://github.com/getsentry/sentry-javascript/blob/master/packages/browser/src/integrations/breadcrumbs.ts#L112\n  let target;\n  let targetNode;\n\n  // Accessing event.target can throw (see getsentry/raven-js#838, #768)\n  try {\n    targetNode = getTargetNode(handlerData);\n    target = htmlTreeAsString(targetNode);\n  } catch (e) {\n    target = '<unknown>';\n  }\n\n  if (target.length === 0) {\n    return null;\n  }\n\n  return createBreadcrumb({\n    category: `ui.${handlerData.name}`,\n    message: target,\n    data: {\n      // Not sure why this errors, Node should be correct (Argument of type 'Node' is not assignable to parameter of type 'INode')\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      ...(targetNode ? { nodeId: record.mirror.getId(targetNode as any) } : {}),\n    },\n  });\n}\n\nfunction getTargetNode(handlerData: DomHandlerData): Node {\n  if (isEventWithTarget(handlerData.event)) {\n    return handlerData.event.target;\n  }\n\n  return handlerData.event;\n}\n\nfunction isEventWithTarget(event: unknown): event is { target: Node } {\n  return !!(event as { target?: Node }).target;\n}\n"],"names":["htmlTreeAsString","createBreadcrumb","record"],"mappings":";;;;;;;AAWA;AACA;AACA;AACA,SAAA,SAAA,CAAA,WAAA,EAAA;AACA;AACA,EAAA,IAAA,MAAA,CAAA;AACA,EAAA,IAAA,UAAA,CAAA;AACA;AACA;AACA,EAAA,IAAA;AACA,IAAA,UAAA,GAAA,aAAA,CAAA,WAAA,CAAA,CAAA;AACA,IAAA,MAAA,GAAAA,sBAAA,CAAA,UAAA,CAAA,CAAA;AACA,GAAA,CAAA,OAAA,CAAA,EAAA;AACA,IAAA,MAAA,GAAA,WAAA,CAAA;AACA,GAAA;AACA;AACA,EAAA,IAAA,MAAA,CAAA,MAAA,KAAA,CAAA,EAAA;AACA,IAAA,OAAA,IAAA,CAAA;AACA,GAAA;AACA;AACA,EAAA,OAAAC,iCAAA,CAAA;AACA,IAAA,QAAA,EAAA,CAAA,GAAA,EAAA,WAAA,CAAA,IAAA,CAAA,CAAA;AACA,IAAA,OAAA,EAAA,MAAA;AACA,IAAA,IAAA,EAAA;AACA;AACA;AACA,MAAA,IAAA,UAAA,GAAA,EAAA,MAAA,EAAAC,aAAA,CAAA,MAAA,CAAA,KAAA,CAAA,UAAA,EAAA,EAAA,GAAA,EAAA,CAAA;AACA,KAAA;AACA,GAAA,CAAA,CAAA;AACA,CAAA;AACA;AACA,SAAA,aAAA,CAAA,WAAA,EAAA;AACA,EAAA,IAAA,iBAAA,CAAA,WAAA,CAAA,KAAA,CAAA,EAAA;AACA,IAAA,OAAA,WAAA,CAAA,KAAA,CAAA,MAAA,CAAA;AACA,GAAA;AACA;AACA,EAAA,OAAA,WAAA,CAAA,KAAA,CAAA;AACA,CAAA;AACA;AACA,SAAA,iBAAA,CAAA,KAAA,EAAA;AACA,EAAA,OAAA,CAAA,CAAA,CAAA,KAAA,GAAA,MAAA,CAAA;AACA;;;;"}